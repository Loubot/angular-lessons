(function() {
  'use strict';
  /* global angular */

  angular
    .module('sb-jsonld.directives')
    .directive('sbJsonld', sbJsonld);

  sbJsonld.$inject = ['$sce'];


  /**
   * Replaces the element with a script[type=appliaction/ld+json] tag.
   *
   * Usage:
   * my.controller.js:
   *  angular
   *    .module('my-module', [])
   *    .controller('MyController', function($scope) {
   *      $scope.myJson = {
   *        "test": "test
   *      }
   *    });
   *
   * index.html:
   *  <sb-jsonld json="{{myJson}}"></sb-jsonld>
   *
   * Result:
   *  <script type="application/ld+json">
   *    {
   *      "test": "test"
   *    }
   *  </script>
   *
   * @param {Object} $filter - Angular $filter service
   * @param {Object} $sce - Angular $sce service
   *
   * @return {Object} directive
   */
  function sbJsonld($sce) {
    var directive = {
      link: link,
      replace: true,
      restrict: 'E',
      template: '<script type="application/ld+json" ng-bind-html="json"></script>'
    };

    function link(scope, element, attributes) {
      attributes.$observe('json', function(value) {
        scope.json = $sce.trustAsHtml(value);
      });
    }

    return directive;
  }
})();
